import feedsReducer, { getFeeds, initialState } from './feedsSlice';

describe('тесты редюсера feedsSlice', () => {
  test('экшен начала запроса', () => {
    const action = { type: getFeeds.pending.type };
    const state = feedsReducer(initialState, action);
    expect(state).toEqual({ ...initialState, isFeedsLoading: true, error: '' });
  });

  test('экшен успешного выполнения запроса', () => {
    const feeds = {
      orders: [
        {
          _id: '677fb544133acd001be49308',
          status: 'done',
          name: 'Экзо-плантаго краторный традиционный-галактический астероидный бургер',
          createdAt: '2025-01-09T11:38:44.859Z',
          updatedAt: '2025-01-09T11:38:45.806Z',
          number: 65065,
          ingredients: [
            '643d69a5c3f7b9001cfa093c',
            '643d69a5c3f7b9001cfa0949',
            '643d69a5c3f7b9001cfa094a',
            '643d69a5c3f7b9001cfa0944',
            '643d69a5c3f7b9001cfa093c'
          ]
        },
        {
          _id: '677fb529133acd001be49307',
          status: 'done',
          name: 'Альфа-сахаридный краторный био-марсианский бургер',
          createdAt: '2025-01-09T11:38:17.077Z',
          updatedAt: '2025-01-09T11:38:17.855Z',
          number: 65064,
          ingredients: [
            '643d69a5c3f7b9001cfa093c',
            '643d69a5c3f7b9001cfa0941',
            '643d69a5c3f7b9001cfa0948',
            '643d69a5c3f7b9001cfa093c'
          ]
        },
        {
          _id: '677fb319133acd001be49305',
          status: 'done',
          name: 'Флюоресцентный люминесцентный бургер',
          createdAt: '2025-01-09T11:29:29.446Z',
          updatedAt: '2025-01-09T11:29:30.446Z',
          number: 65063,
          ingredients: [
            '643d69a5c3f7b9001cfa093d',
            '643d69a5c3f7b9001cfa093e',
            '643d69a5c3f7b9001cfa093d'
          ]
        }
      ],
      total: 3,
      totalToday: 3
    };

    const action = {
      type: getFeeds.fulfilled.type,
      payload: feeds
    };

    const state = feedsReducer(initialState, action);

    expect(state).toEqual({
      isFeedsLoading: false,
      error: '',
      data: feeds
    });
  });

  test('экшен ошибки запроса', () => {
    const errorMessage = 'Ошибка запроса заказов';
    const action = {
      type: getFeeds.rejected.type,
      error: { message: errorMessage }
    };
    const state = feedsReducer(initialState, action);
    expect(state).toEqual({
      ...initialState,
      error: errorMessage,
      isFeedsLoading: false
    });
  });
});
